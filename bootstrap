#!/usr/bin/env bash

bootstrap() {
    local iCloud="${HOME}/Library/Mobile Documents/com~apple~CloudDocs"
    local -a targets=( '.vim' '.vimrc' '.xvimrc' '.zshrc' '.zshenv' '.ipython'
    '.bin' '.tigrc' '.git_template' '.gitignore' '.gitconfig' '.tmux.conf'
    )
    local -a vim_dirs=( 'Vim/pack' 'Vim/spell' )
    local candidate
    local target
    local dest

    for candidate in "${targets[@]}"; do
        target="$(pwd)/${candidate}"
        dest="$HOME"
        if [[ -f "$target" ]]; then
            ln -sfv -- "$target" "$dest"
        elif [[ -d "$target" ]]; then
            ln -sFv -- "$target" "$dest"
        else
            printf >&2 'No such file or directory: %s\n' "$target"
        fi
    done
    mkdir -p "${HOME}/.vim/backup/undo"

    for vim_dir in "${vim_dirs[@]}"; do
        [[ ! -d "${iCloud}/${vim_dir}" ]] && continue
        dest="${HOME}/.vim/$(basename "$vim_dir")"
        if [[ -d "${dest}" ]]; then
            printf -- 'Moving existing %s directory to Trash\n' "$dest"
            mv -v --  "$dest" "${HOME}/.Trash"
        fi
        ln -sFv -- "${iCloud}/${vim_dir}" "${dest}"
    done

    if [[ -d "${iCloud}/.weechat" ]]; then
        if [[ -d "${HOME}/.weechat" ]]; then
            printf -- 'Moving existing %s directory to Trash\n' "${HOME}/.weechat"
            mv -v --  "${HOME}/.weechat" "${HOME}/.Trash"
        fi
        ln -sFv -- "${iCloud}/.weechat" "$HOME"
    fi
}

bootstrap
